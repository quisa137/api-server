<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="users">
    <select id="SelectGroupByPK" resultType="com.jindata.apiserver.service.dto.Group">
        select groupno, name, `desc` from groups WHERE groupno in (SELECT groupno FROM group_user WHERE userno = #{userno,jdbcType=BIGINT})
    </select>
    <resultMap type="com.jindata.apiserver.service.dto.User" id="ResultMapUsers">
      <id column="groupno" jdbcType="BIGINT"/>
      <result column="name" jdbcType="VARCHAR"/>
      <result column="desc" jdbcType="VARCHAR"/>
      <collection property="groups" column="userno" ofType="com.jindata.apiserver.service.dto.Group" select="SelectGroupByPK" />
    </resultMap>
    <select id="SelectUserByPK" resultMap="ResultMapUsers">
      select userno, username, email, PASSWORD from users where userno = #{userno,jdbcType=BIGINT} and isdeleted='N'
    </select>
    <select id="userInfoByEmail" parameterType="map" resultType="map">
		select USERNO, username, email, PASSWORD from users where email = #{email} and isdeleted='N'
	</select>

	<select id="userInfoByPassword" parameterType="map" resultType="map">
		select USERID, username, email, PASSWORD from users where userno = #{userno,jdbcType=BIGINT} and password = #{password} and isdeleted='N'
	</select>
  
    <insert id="userCreate" parameterType="com.jindata.apiserver.service.dto.User" flushCache="true" statementType="PREPARED">
        insert into users (username,password,email,isdeleted) 
        values (#{username,javaType=String,jdbcType=VARCHAR},password(#{password,javaType=String,jdbcType=VARCHAR}),#{email,javaType=String,jdbcType=VARCHAR},'N')
    </insert>
    
    <update id="userUpdate">
        update users
        <set>
          <if test="username!=null">username = #{username}</if>
          <if test="password!=null">password = #{password}</if>
          <if test="email!=null">email = #{email}</if>
        </set>
        WHERE userno=#{userno} and isdeleted='N'
    </update>
    
    <delete id="userDelete">
      UPDATE users SET isdeleted = 'Y' WHERE userno=#{userno}
    </delete>
</mapper>
<!-- 
USERNO INT GENERATED BY DEFAULT AS IDENTITY 
          (START WITH 1, INCREMENT BY 1) NOT NULL,
    USERID VARCHAR(45) NOT NULL,
	USERNAME VARCHAR(45) NOT NULL,
	PASSWORD VARCHAR(45) NOT NULL,
 -->